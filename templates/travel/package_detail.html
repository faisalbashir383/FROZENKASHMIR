{% extends 'travel/base.html' %}

{% block title %}{{ package.title }} - {{ package.destination.name }} Tour Package | Frozen Kashmir{% endblock %}

{% block meta_description %}{{ package.overview|truncatewords:30 }} Book now for ₹{{ package.price }}. Duration: {{
package.duration }}.{% endblock %}

{% block meta_keywords %}{{ package.title }}, {{ package.destination.name }} tour, Kashmir {{
package.get_category_display }} package, {{ package.duration }} Kashmir trip{% endblock %}

{% block og_title %}{{ package.title }} - Kashmir Tour Package{% endblock %}
{% block og_description %}{{ package.overview|truncatewords:25 }}{% endblock %}
{% block og_image %}https://frozenkashmir.com{{ package.image.url }}{% endblock %}
{% block og_type %}product{% endblock %}

{% block extra_structured_data %}
{# Product Schema for Tour Package #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ package.title }}",
  "description": "{{ package.overview|escapejs }}",
  "image": "https://frozenkashmir.com{{ package.image.url }}",
  "brand": {
    "@type": "Brand",
    "name": "Frozen Kashmir Tour & Travels"
  },
  "offers": {
    "@type": "Offer",
    "url": "https://frozenkashmir.com{% url 'package_detail' package.slug %}",
    "priceCurrency": "INR",
    "price": "{{ package.price }}",
    "availability": "https://schema.org/InStock",
    "validFrom": "{{ package.created_at|date:'Y-m-d' }}"
  }{% if package.get_average_rating > 0 %},
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ package.get_average_rating }}",
    "reviewCount": "{{ package.reviews.count }}"
  }{% endif %}
}
</script>

{# TravelAction Schema #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TravelAction",
  "name": "{{ package.title }}",
  "description": "{{ package.overview|escapejs }}",
  "target": {
    "@type": "TouristDestination",
    "name": "{{ package.destination.name }}",
    "description": "{{ package.destination.description|escapejs }}"
  },
  "provider": {
    "@type": "TravelAgency",
    "name": "Frozen Kashmir Tour & Travels",
    "telephone": "+91-95419-05293"
  }
}
</script>

{# BreadcrumbList Schema #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://frozenkashmir.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Packages",
      "item": "https://frozenkashmir.com{% url 'package_list' %}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ package.title }}",
      "item": "https://frozenkashmir.com{% url 'package_detail' package.slug %}"
    }
  ]
}
</script>
{% endblock %}

{% block content %}
<div class="section package-detail-container" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
  <div>
    {% if package.image %}
    <img src="{{ package.image.url }}" alt="{{ package.title }}"
      style="width: 100%; border-radius: 8px; margin-bottom: 2rem;">
    {% endif %}

    <h1>{{ package.title }}</h1>
    <div style="margin-bottom: 1rem; color: #666;">
      <span>{{ package.duration }}</span> | <span>{{ package.get_category_display }}</span> | <span>{{
        package.destination.name }}</span>
    </div>

    <div style="margin-bottom: 2rem;">
      <h3>Overview</h3>
      <p>{{ package.overview }}</p>
    </div>

    <div style="margin-bottom: 2rem;">
      <h3>Itinerary</h3>
      <div style="white-space: pre-line;">{{ package.itinerary }}</div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
      <div>
        <h3>Inclusions</h3>
        <div style="white-space: pre-line; color: green;">{{ package.inclusions }}</div>
      </div>
      <div>
        <h3>Exclusions</h3>
        <div style="white-space: pre-line; color: red;">{{ package.exclusions }}</div>
      </div>
    </div>
  </div>

  <div>
    <div
      style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 100px;">
      <div class="price" style="font-size: 2rem; margin-bottom: 1rem;">₹{{ package.price }}</div>

      <h3>Book This Tour</h3>
      <form method="post">
        {% csrf_token %}
        <div style="margin-bottom: 1rem;">
          <label>Name</label>
          <input type="text" name="name" required style="width: 100%; padding: 0.5rem;">
        </div>
        <div style="margin-bottom: 1rem;">
          <label>Email</label>
          <input type="email" name="email" required style="width: 100%; padding: 0.5rem;">
        </div>
        <div style="margin-bottom: 1rem;">
          <label>Phone</label>
          <input type="tel" name="phone" required style="width: 100%; padding: 0.5rem;">
        </div>
        <div style="margin-bottom: 1rem;">
          <label>Travel Date</label>
          <input type="date" name="date" required style="width: 100%; padding: 0.5rem;">
        </div>
        <div style="margin-bottom: 1rem;">
          <label>Travelers</label>
          <input type="number" name="travelers" min="1" value="1" required style="width: 100%; padding: 0.5rem;">
        </div>
        <button type="submit" class="btn" style="width: 100%;">Request Booking</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}